<div style="display:flex; flex-direction:column;">
{% if videos: %}
    {% for video in videos: %}
    {% if comments: %}   
        <div class="card my-3" style="width: 60%; margin: 0 auto; --max-height: 35rem;">
            <div class="card-body">
                <div class="row">
                    <div class="col">
                        <div class="" style="display: block; object-fit:contain;">  <!-- d-flex justify-content-center -->
                            <video class="" style="width: 100% !important; height: auto !important; object-fit:contain;" controls>
                                <source src="https://engr-4450-fp.s3.us-east-2.amazonaws.com/{{ video['video_s3_path'] }}" type="video/mp4">
                            </video>
                        </div>
                    </div>
                    <div class="col">
                        <div class="container">
                            <div class="row mb-2">
                                <div class="col-3 mx-0 px-0">
                                    <script type="text/javascript">     
                                        //var numLikes_{{video['vid_id']}} = {{ video['num_likes'] }};
                                        function like_video_local_{{video['vid_id']}}(e){
                                            //alert(numLikes_{{video['vid_id']}});
                                            //numLikes_{{video['vid_id']}}+=1;
                                            //$("#like_vid_form_{{video['vid_id']}}").submit();
                                            
                                            $.ajax({ 
                                                type: "POST", 
                                                url: '{{url_for('live.like_video', video_id=video['vid_id'])}}', 
                                                data: $('#like_vid_form_{{video['vid_id']}}').serialize(), 
                                                success: function(data) { 
                                                    // Ajax call completed successfully 
                                                    //alert("Form Submited Successfully - like", parseInt(data)); 
                                                    console.log(data)
                                                    $('#like_vid_form_{{video['vid_id']}}').replaceWith(`
                                                    <form id="unlike_vid_form_{{video['vid_id']}}" action="{{url_for('live.unlike_video', video_id=video['vid_id'])}}" method="post" class="px-0">
                                                        <input type="hidden" value="{{ video['vid_id'] }}"/>
                                                        <button onclick="unlike_video_local_{{video['vid_id']}}();" id="btn-unlike-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up-fill"></i> `+parseInt(data)+`</button>
                                                    </form>
                                                    `);
                                                    
                                                    //.replaceWith('<button onclick="unlike_video_local_{{video['vid_id']}}();" id="btn-unlike-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up-fill"></i> '+parseInt(data)+'</button>');
                                                }, 
                                                error: function(data) { 
                                                      
                                                    // Some error in ajax call 
                                                    alert("Error Liking Post"); 
                                                } 
                                            });

                                        };
                                        function unlike_video_local_{{video['vid_id']}}(){
                                            //alert(numLikes_{{video['vid_id']}});
                                            //numLikes_{{video['vid_id']}}-=1;
                                            //$("#unlike_vid_form_{{video['vid_id']}}").submit();
                                            //$('#btn-unlike-vid').replaceWith('<button onclick="like_video_local_{{video['vid_id']}}();" id="btn-like-vid" type="submit" class="btn"><i class="bi bi-hand-thumbs-up"></i> '+numLikes_{{video['vid_id']}}+'</button>');
                                            $.ajax({ 
                                                type: "POST", 
                                                url: '{{url_for('live.unlike_video', video_id=video['vid_id'])}}', 
                                                data: $('#unlike_vid_form_{{video['vid_id']}}').serialize(), 
                                                success: function(data) { 
                                                    // Ajax call completed successfully 
                                                    //alert("Form Submited Successfully - unlike", parseInt(data)); 
                                                    console.log(data)
                                                    $('#unlike_vid_form_{{video['vid_id']}}').replaceWith(`
                                                    <form id="like_vid_form_{{video['vid_id']}}" action="{{url_for('live.like_video', video_id=video['vid_id'])}}" method="post" class="px-0">
                                                        <input type="hidden" value="{{ video['vid_id'] }}"/>
                                                        <button onclick="like_video_local_{{video['vid_id']}}();" id="btn-like-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up"></i> `+parseInt(data)+`</button>
                                                    </form>
                                                    `);
                                                    
                                                    //.replaceWith('<form id="like_vid_form_{{video['vid_id']}}" action="{{url_for('live.like_video', video_id=video['vid_id'])}}" method="post" class="px-0"><input type="hidden" value="{{ video['vid_id'] }}"/><button onclick="like_video_local_{{video['vid_id']}}();" id="btn-like-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up"></i> {{ video['num_likes'] }}</button></form><button onclick="like_video_local_{{video['vid_id']}}();" id="btn-like-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up"></i> '+parseInt(data)+'</button>');
                                                }, 
                                                error: function(data) { 
                                                      
                                                    // Some error in ajax call 
                                                    alert("Error Unliking Post"); 
                                                } 
                                            });
                                        };
                                        
                                    </script>
                                    {% if video['vid_id'] in likes %}
                                    <form id="unlike_vid_form_{{video['vid_id']}}" action="{{url_for('live.unlike_video', video_id=video['vid_id'])}}" method="post" class="px-0">
                                        <input type="hidden" value="{{ video['vid_id'] }}"/>
                                        <button onclick="unlike_video_local_{{video['vid_id']}}();" id="btn-unlike-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up-fill"></i> {{ video['num_likes'] }}</button>
                                    </form>
                                    {% else %}
                                    <form id="like_vid_form_{{video['vid_id']}}" action="{{url_for('live.like_video', video_id=video['vid_id'])}}" method="post" class="px-0">
                                        <input type="hidden" value="{{ video['vid_id'] }}"/>
                                        <button onclick="like_video_local_{{video['vid_id']}}();" id="btn-like-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up"></i> {{ video['num_likes'] }}</button>
                                    </form>
                                    {% endif %}
                                </div>
                                <div class="col mx-0 px-0">
                                    <div class="d-flex flex-row-reverse my-1">
                                        {% if video['prof_pic_s3_path'] %}
                                            <h5 class="">
                                                <img style="width: 20px; object-fit:cover; aspect-ratio: 1/1;  border-radius: 100%;" src="https://engr-4450-fp.s3.us-east-2.amazonaws.com/{{ video["prof_pic_s3_path"] }}" alt="User profile icon"/>
                                                 {{ video['uploader_id'] }}-{{video["usr_login"]}}</h5>
                                        {% else %}
                                            <h5 class="mb-0"><i class="bi bi-person-circle"></i> {{ video['uploader_id'] }}-{{video["usr_login"]}}</h5>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-2 py-auto mx-0 mr-0 pr-0">
                                    <div class="d-flex flex-row-reverse">
                                        <a title="Expand video" href="{{url_for('live.view_video', vid_id=video['vid_id'])}}" class="btn btn-light"><i class="bi bi-box-arrow-up-right"></i></a>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                        
                        

                        <div class="card">
                            <div class="card-header py-1">
                              Comments
                            </div>
                            <ul class="list-group list-group-flush" style="max-height: 20rem; overflow-y: auto;">
                                {% for comment in comments[video['vid_id']]: %}    
                                    <!-- <p>{{ comment["user_id"] }}: {{ comment["comment_text"] }}</p> -->
                                    <li class="list-group-item">{{ comment["usr_login"] }}: {{ comment["comment_text"] }}</li>
                                {% endfor %}
                                <!-- <p>add somethign for zero comments</p> -->
                                <!-- <li class="list-group-item">
                                    
                                </li> -->
                            </ul>
                            <div class="card-footer">
                                <form class="d-flex" action="{{url_for('live.submit_video_comment')}}" method="post">
                                    <input type="hidden" value="{{ video['vid_id'] }}" name="vid_id"/>
                                    <input type="hidden" id="user_id_val" name="user_id" value={{ session['user_id'] }}>
                                    <!-- <div class="form-row">
                                        <div class="col"> -->
                                            <input class="form-control" type="text" name="comment_text" required />
                                        <!-- </div>
                                        <div class="col"> -->
                                            <button class="btn btn-primary ml-1" type="submit">Post</button> 
                                        <!-- </div> -->
                                        
                                    </div>
                                </form>
                            </div>
                            
                            
                          </div>
                    </div>
                    <!-- <p>video-{{ video['vid_id'] }}</p>   -->
            </div>
        </div>  
        {% else %}
        <div class="card my-3" style="width: 30%; margin: 0 auto; --max-height: 35rem;">
            <div class="card-body">
                    <div class="row">
                    <div class="col" style="">
                        <div class="row mb-2 mx-0">
                            <div class="col-3 mx-0 px-0">
                                <script type="text/javascript">     
                                    //var numLikes_{{video['vid_id']}} = {{ video['num_likes'] }};
                                    function like_video_local_{{video['vid_id']}}(e){
                                        //alert(numLikes_{{video['vid_id']}});
                                        //numLikes_{{video['vid_id']}}+=1;
                                        //$("#like_vid_form_{{video['vid_id']}}").submit();
                                        
                                        $.ajax({ 
                                            type: "POST", 
                                            url: '{{url_for('live.like_video', video_id=video['vid_id'])}}', 
                                            data: $('#like_vid_form_{{video['vid_id']}}').serialize(), 
                                            success: function(data) { 
                                                // Ajax call completed successfully 
                                                //alert("Form Submited Successfully - like", parseInt(data)); 
                                                console.log(data)
                                                $('#like_vid_form_{{video['vid_id']}}').replaceWith(`
                                                <form id="unlike_vid_form_{{video['vid_id']}}" action="{{url_for('live.unlike_video', video_id=video['vid_id'])}}" method="post" class="px-0">
                                                    <input type="hidden" value="{{ video['vid_id'] }}"/>
                                                    <button onclick="unlike_video_local_{{video['vid_id']}}();" id="btn-unlike-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up-fill"></i> `+parseInt(data)+`</button>
                                                </form>
                                                `);
                                                
                                                //.replaceWith('<button onclick="unlike_video_local_{{video['vid_id']}}();" id="btn-unlike-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up-fill"></i> '+parseInt(data)+'</button>');
                                            }, 
                                            error: function(data) { 
                                                  
                                                // Some error in ajax call 
                                                alert("Error Liking Post"); 
                                            } 
                                        });
    
                                    };
                                    function unlike_video_local_{{video['vid_id']}}(){
                                        //alert(numLikes_{{video['vid_id']}});
                                        //numLikes_{{video['vid_id']}}-=1;
                                        //$("#unlike_vid_form_{{video['vid_id']}}").submit();
                                        //$('#btn-unlike-vid').replaceWith('<button onclick="like_video_local_{{video['vid_id']}}();" id="btn-like-vid" type="submit" class="btn"><i class="bi bi-hand-thumbs-up"></i> '+numLikes_{{video['vid_id']}}+'</button>');
                                        $.ajax({ 
                                            type: "POST", 
                                            url: '{{url_for('live.unlike_video', video_id=video['vid_id'])}}', 
                                            data: $('#unlike_vid_form_{{video['vid_id']}}').serialize(), 
                                            success: function(data) { 
                                                // Ajax call completed successfully 
                                                //alert("Form Submited Successfully - unlike", parseInt(data)); 
                                                console.log(data)
                                                $('#unlike_vid_form_{{video['vid_id']}}').replaceWith(`
                                                <form id="like_vid_form_{{video['vid_id']}}" action="{{url_for('live.like_video', video_id=video['vid_id'])}}" method="post" class="px-0">
                                                    <input type="hidden" value="{{ video['vid_id'] }}"/>
                                                    <button onclick="like_video_local_{{video['vid_id']}}();" id="btn-like-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up"></i> `+parseInt(data)+`</button>
                                                </form>
                                                `);
                                                
                                                //.replaceWith('<form id="like_vid_form_{{video['vid_id']}}" action="{{url_for('live.like_video', video_id=video['vid_id'])}}" method="post" class="px-0"><input type="hidden" value="{{ video['vid_id'] }}"/><button onclick="like_video_local_{{video['vid_id']}}();" id="btn-like-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up"></i> {{ video['num_likes'] }}</button></form><button onclick="like_video_local_{{video['vid_id']}}();" id="btn-like-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up"></i> '+parseInt(data)+'</button>');
                                            }, 
                                            error: function(data) { 
                                                  
                                                // Some error in ajax call 
                                                alert("Error Unliking Post"); 
                                            } 
                                        });
                                    };
                                    
                                </script>
                                {% if video['vid_id'] in likes %}
                                <form id="unlike_vid_form_{{video['vid_id']}}" action="{{url_for('live.unlike_video', video_id=video['vid_id'])}}" method="post" class="px-0">
                                    <input type="hidden" value="{{ video['vid_id'] }}"/>
                                    <button onclick="unlike_video_local_{{video['vid_id']}}();" id="btn-unlike-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up-fill"></i> {{ video['num_likes'] }}</button>
                                </form>
                                {% else %}
                                <form id="like_vid_form_{{video['vid_id']}}" action="{{url_for('live.like_video', video_id=video['vid_id'])}}" method="post" class="px-0">
                                    <input type="hidden" value="{{ video['vid_id'] }}"/>
                                    <button onclick="like_video_local_{{video['vid_id']}}();" id="btn-like-vid" type="button" class="btn"><i class="bi bi-hand-thumbs-up"></i> {{ video['num_likes'] }}</button>
                                </form>
                                {% endif %}
                            </div>
                            <div class="col mx-0 px-0">
                                <div class="d-flex flex-row-reverse my-1">
                                    {% if video['prof_pic_s3_path'] %}
                                        <h5 class="">
                                            <!-- <img src="video['prof_pic_s3_path']" alt="profile pic" /> -->
                                            <img style="width: 20px; object-fit:cover; aspect-ratio: 1/1;  border-radius: 100%;" src="https://engr-4450-fp.s3.us-east-2.amazonaws.com/{{video['prof_pic_s3_path']}}" alt="User profile icon"/>
                                             {{ video['uploader_id'] }}-{{video["usr_login"]}}</h5>
                                    {% else %}
                                        <h5 class="mb-0"><i class="bi bi-person-circle"></i> {{ video['uploader_id'] }}-{{video["usr_login"]}}</h5>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-2 py-auto mx-0 mr-0 pr-0">
                                <div class="d-flex flex-row-reverse">
                                    <a title="Expand video" href="{{url_for('live.view_video', vid_id=video['vid_id'])}}" class="btn btn-light"><i class="bi bi-box-arrow-up-right"></i></a>
                                </div>
                            </div>
                        </div>
                        <div class="" style="display: block; object-fit:contain;">  <!-- d-flex justify-content-center -->
                            <!-- <video class="" style="--max-height: 30rem;" controls>
                                <source src="https://engr-4450-fp.s3.us-east-2.amazonaws.com/{{ video['video_s3_path'] }}" type="video/mp4">
                            </video> -->
                            <video class="" style="width: 100% !important; height: auto !important; object-fit:contain;" controls>
                                <source src="https://engr-4450-fp.s3.us-east-2.amazonaws.com/{{ video['video_s3_path'] }}" type="video/mp4">
                            </video>
                        </div>
                    </div>
                    </div>
            </div>
        </div>
        {% endif %}        
    {% endfor %}
{% else %}
    <div>
        <h3><i class="bi bi-dropbox"></i> No videos to show here </h3>
    </div>
{% endif %}
</div>
